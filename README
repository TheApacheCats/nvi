#	$Id: README,v 8.3 1993/07/07 18:02:17 bostic Exp $ (Berkeley) $Date: 1993/07/07 18:02:17 $

This is the README for version 0.5 of nex/nvi, a freely redistributable
replacement for the vi/ex text editors.  Please note that this is ALPHA
software at the time of its release with 4.4BSD, and that it is not yet
ready for prime time!

New versions of this software will be available by anonymous ftp from
ftp.cs.berkeley.edu, in the file ucb/4bsd/nvi.tar.Z, or from ftp.uu.net.

This software is derived from software contributed to UC Berkeley by
Steve Kirkendall, the author of the vi clone elvis.  Without his work,
this work would have been far more difficult.

Regular expressions support is courtesy of Henry Spencer, for which I
am *very* grateful.

Email questions may be addressed to Keith Bostic at bostic@cs.berkeley.edu.

=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

+ Comments:

This software is alpha software, at best.  I believe that almost all of
the necessary functionality for ex/vi is in it, but it's definitely not
ready for prime time.  Code fixes are, of course, very much appreciated,
but if you don't have time, please send me as much information as you can
as to how to reproduce the bug, and I'll fix it here.  In particular, the
screen routines are nasty stuff, and you probably don't want to mess with
them.  Stack traces of core dumps are helpful, but even more helpful is
an example file with a set of keystrokes.

Nvi is mostly 8-bit clean.  This isn't difficult to fix, and was left in
during initial development to make things easier.  Wide character support
will be integrated at the same time it is made fully 8-bit clean.

+ Major known bugs:

	o Characters input using the 'R' command cannot be erased.
	o Several options have not been implemented: wrapmargin,
	  showmatch, remap, and a few others.
	o Nvi uses POSIX 1003.2 basic and extended RE's.  The historic
	  hacks will be put in soon.

	And, frankly, fairly random other stuff.

+ Some of the cool stuff:

	o Split screens; try :split, and ^W to move around.
	o Practically infinite lines/files; try nvi /vmunix.
	o Tag stacks; try ^T to return from tagged positions.

+ Porting information:

The directory PORT has a old-style Makefile which builds the entire nvi
distribution.  See it and the file PORT/README for more information.

+ Temporary files and recovery:

Edit sessions are backed by files in /var/tmp/vi.recover, and are named
"vi.XXX", where "XXX" is a number usually associated with the process id.
When the file is first modified, a second file, which contains an email
message for the user, is created, and is named "recover.XXX", where,
again, "XXX" is associated with the process id.  Both files are removed
at the end of a normal edit session, but will remain if the edit session
is abnormally terminated or the user uses the ex/vi "preserve" command.
The recover file has all of the necessary information in it to enable the
user to recover the edit session.  In addition, it has all of the
necessary email headers for sendmail.  When the system is rebooted, all
of the files in /var/tmp/vi.recover named "recover.XXX" should be emailed,
using the -t flag of sendmail (or a similar mechanism with other mailers).
A simple way to do this is to insert the following script into your
rc.local file:

	for i in /var/tmp/vi.recover/recover.*; do
		sendmail -t < $i
	done

There is no "recovery" program with nvi, nor does not run setuid.  Users
may "recover" any file which they may read, i.e. the superuser can recover
any edit session.

+ A quick tour:

The main directory, nvi, contains some source files for various pieces
of code that are shared by both ex and vi, mostly logging code or code
translating line numbers into requests to the dbopen(3) database code.
It also has the code for adding, deleting, and changing "records" in
the underlying database.

The nvi/ex directory is the ex source code.  Lots of this code is used by
vi, however.  Generally, if the functionality is shared by both ex and
vi, it's in nvi/ex, if it's vi only, it's in nvi/vi.  Files are generally
named by the command(s) they support, but occasionally with a name that
describes their functionality.

The nvi/vi directory is the vi source code.

There are a small set of functions that comprise the interface between
the editor (ex and/or vi) and their screens.  This is intended to make
it easy to add new screens in the future.  The nvi/sex directory is the
screen code for ex.  The nvi/svi directory is the curses screen code for
vi.

+ Data structures:

There are three basic data structures in this editor.  The first is a
single global structure (GS) which contains information common to all
files and screens.  It's really pretty tiny, and functions more as a
single place to hang things than anything else.

The second and third structures are the file structures (EXF) and the
screen structures (SCR).  They contain information theoretically unique
to a screen or file, respectively.  The GS structure contains linked
lists of EXF and SCR structures.  The structures can also be classed by
persistence.  The GS structure never goes away and the SCR structure
persists over instances of files.

In general, we pass an SCR structure and an EXF structure around to editor
functions.  The SCR structure is necessary for any routine that wishes to
talk to the screen, the EXF structure is necessary for any routine that
wants to modify the file.  The relationship between an SCR structure and
its underlying EXF structure is not fixed, and although you can translate
from an SCR to the underlying EXF, it is discouraged.  If this becomes
too onerous, I suspect I'll just stop passing around the EXF in the future.

The naming is consistent across the program.  (Macros even depend on it,
so don't try and change it!)  The global structure is "gp", the screen
structure is "sp", and the file structure is "ep".

A few others data structures:

TEXT	In nvi/cut.h.  This structure describes a portion of a line,
	and is used by the input routines and as the "line" part of a
	cut buffer.

CB	In nvi/cut.h.	A cut buffer.  A cut buffer is a place to
	hang a list of TEXT structures.

MARK	In nvi/mark.h.  A cursor position, consisting of a line number
	and a column number.

MSG	In nvi/msg.h.  A chain of messages for the user.

SEQ	In nvi/seq.h.  An abbreviation or a map entry.

EXCMDARG
	In nvi/ex/excmd.h.stub.  The structure that gets passed around
	to the functions that implement the ex commands.  (The main
	ex command loop (see nvi/ex/ex.c) builds this up and then passes
	it to the ex functions.)

VICMDARG
	In nvi/vi/vcmd.h.  The structure that gets passed around to the
	functions that implement the vi commands.  (The main vi command
	loop (see nvi/vi/vi.c) builds this up and then passes it to the
	vi functions.)
