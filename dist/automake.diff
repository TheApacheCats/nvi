--- /usr/bin/automake	Mon Apr 10 19:03:48 2000
+++ automake	Mon Apr 24 23:55:14 2000
@@ -1174,6 +1174,7 @@
 	    next if ! /^((.*)\/)?([^\/]*)\.(.*)$/;
 	    $full = $_;
 	    $directory = $2;
+	    ++$sourcedirs{$2} if ($2);
 	    $base = $3;
 	    $extension = $4;
 
@@ -2944,6 +2945,14 @@
 							     . $xform1,
 							     'depend2')
 			      . "\n");
+	    for $sourcedir (keys %sourcedirs) {
+		$output_rules .= (&file_contents_with_transform (
+					's/\@EXT\@([^:]*):/'
+					 . '%$1: ' . quotemeta($sourcedir) . '\/%' . $ext .  '/g;'
+					 . $xform1,
+					 'depend2')
+				  . "\n");
+	    }
 	}
     }
 
